"use strict";(()=>{function J(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)r.hasOwnProperty(n)&&(e[n]=r[n])}return e}function C(e,t){return Array(t+1).join(e)}function I(e){return e.replace(/^\n*/,"")}function P(e){for(var t=e.length;t>0&&e[t-1]===`
`;)t--;return e.substring(0,t)}function H(e){return P(I(e))}var ee=["ADDRESS","ARTICLE","ASIDE","AUDIO","BLOCKQUOTE","BODY","CANVAS","CENTER","DD","DIR","DIV","DL","DT","FIELDSET","FIGCAPTION","FIGURE","FOOTER","FORM","FRAMESET","H1","H2","H3","H4","H5","H6","HEADER","HGROUP","HR","HTML","ISINDEX","LI","MAIN","MENU","NAV","NOFRAMES","NOSCRIPT","OL","OUTPUT","P","PRE","SECTION","TABLE","TBODY","TD","TFOOT","TH","THEAD","TR","UL"];function R(e){return $(e,ee)}var U=["AREA","BASE","BR","COL","COMMAND","EMBED","HR","IMG","INPUT","KEYGEN","LINK","META","PARAM","SOURCE","TRACK","WBR"];function W(e){return $(e,U)}function te(e){return V(e,U)}var F=["A","TABLE","THEAD","TBODY","TFOOT","TH","TD","IFRAME","SCRIPT","AUDIO","VIDEO"];function re(e){return $(e,F)}function ne(e){return V(e,F)}function $(e,t){return t.indexOf(e.nodeName)>=0}function V(e,t){return e.getElementsByTagName&&t.some(function(r){return e.getElementsByTagName(r).length})}var u={};u.paragraph={filter:"p",replacement:function(e){return`

`+e+`

`}};u.lineBreak={filter:"br",replacement:function(e,t,r){return r.br+`
`}};u.heading={filter:["h1","h2","h3","h4","h5","h6"],replacement:function(e,t,r){var n=Number(t.nodeName.charAt(1));if(r.headingStyle==="setext"&&n<3){var i=C(n===1?"=":"-",e.length);return`

`+e+`
`+i+`

`}else return`

`+C("#",n)+" "+e+`

`}};u.blockquote={filter:"blockquote",replacement:function(e){return e=H(e).replace(/^/gm,"> "),`

`+e+`

`}};u.list={filter:["ul","ol"],replacement:function(e,t){var r=t.parentNode;return r.nodeName==="LI"&&r.lastElementChild===t?`
`+e:`

`+e+`

`}};u.listItem={filter:"li",replacement:function(e,t,r){var n=r.bulletListMarker+"   ",i=t.parentNode;if(i.nodeName==="OL"){var a=i.getAttribute("start"),o=Array.prototype.indexOf.call(i.children,t);n=(a?Number(a)+o:o+1)+".  "}var l=/\n$/.test(e);return e=H(e)+(l?`
`:""),e=e.replace(/\n/gm,`
`+" ".repeat(n.length)),n+e+(t.nextSibling?`
`:"")}};u.indentedCodeBlock={filter:function(e,t){return t.codeBlockStyle==="indented"&&e.nodeName==="PRE"&&e.firstChild&&e.firstChild.nodeName==="CODE"},replacement:function(e,t,r){return`

    `+t.firstChild.textContent.replace(/\n/g,`
    `)+`

`}};u.fencedCodeBlock={filter:function(e,t){return t.codeBlockStyle==="fenced"&&e.nodeName==="PRE"&&e.firstChild&&e.firstChild.nodeName==="CODE"},replacement:function(e,t,r){for(var n=t.firstChild.getAttribute("class")||"",i=(n.match(/language-(\S+)/)||[null,""])[1],a=t.firstChild.textContent,o=r.fence.charAt(0),l=3,c=new RegExp("^"+o+"{3,}","gm"),m;m=c.exec(a);)m[0].length>=l&&(l=m[0].length+1);var g=C(o,l);return`

`+g+i+`
`+a.replace(/\n$/,"")+`
`+g+`

`}};u.horizontalRule={filter:"hr",replacement:function(e,t,r){return`

`+r.hr+`

`}};u.inlineLink={filter:function(e,t){return t.linkStyle==="inlined"&&e.nodeName==="A"&&e.getAttribute("href")},replacement:function(e,t){var r=t.getAttribute("href");r&&(r=r.replace(/([()])/g,"\\$1"));var n=w(t.getAttribute("title"));return n&&(n=' "'+n.replace(/"/g,'\\"')+'"'),"["+e+"]("+r+n+")"}};u.referenceLink={filter:function(e,t){return t.linkStyle==="referenced"&&e.nodeName==="A"&&e.getAttribute("href")},replacement:function(e,t,r){var n=t.getAttribute("href"),i=w(t.getAttribute("title"));i&&(i=' "'+i+'"');var a,o;switch(r.linkReferenceStyle){case"collapsed":a="["+e+"][]",o="["+e+"]: "+n+i;break;case"shortcut":a="["+e+"]",o="["+e+"]: "+n+i;break;default:var l=this.references.length+1;a="["+e+"]["+l+"]",o="["+l+"]: "+n+i}return this.references.push(o),a},references:[],append:function(e){var t="";return this.references.length&&(t=`

`+this.references.join(`
`)+`

`,this.references=[]),t}};u.emphasis={filter:["em","i"],replacement:function(e,t,r){return e.trim()?r.emDelimiter+e+r.emDelimiter:""}};u.strong={filter:["strong","b"],replacement:function(e,t,r){return e.trim()?r.strongDelimiter+e+r.strongDelimiter:""}};u.code={filter:function(e){var t=e.previousSibling||e.nextSibling,r=e.parentNode.nodeName==="PRE"&&!t;return e.nodeName==="CODE"&&!r},replacement:function(e){if(!e)return"";e=e.replace(/\r?\n|\r/g," ");for(var t=/^`|^ .*?[^ ].* $|`$/.test(e)?" ":"",r="`",n=e.match(/`+/gm)||[];n.indexOf(r)!==-1;)r=r+"`";return r+t+e+t+r}};u.image={filter:"img",replacement:function(e,t){var r=w(t.getAttribute("alt")),n=t.getAttribute("src")||"",i=w(t.getAttribute("title")),a=i?' "'+i+'"':"";return n?"!["+r+"]("+n+a+")":""}};function w(e){return e?e.replace(/(\n+\s*)+/g,`
`):""}function _(e){this.options=e,this._keep=[],this._remove=[],this.blankRule={replacement:e.blankReplacement},this.keepReplacement=e.keepReplacement,this.defaultRule={replacement:e.defaultReplacement},this.array=[];for(var t in e.rules)this.array.push(e.rules[t])}_.prototype={add:function(e,t){this.array.unshift(t)},keep:function(e){this._keep.unshift({filter:e,replacement:this.keepReplacement})},remove:function(e){this._remove.unshift({filter:e,replacement:function(){return""}})},forNode:function(e){if(e.isBlank)return this.blankRule;var t;return(t=N(this.array,e,this.options))||(t=N(this._keep,e,this.options))||(t=N(this._remove,e,this.options))?t:this.defaultRule},forEach:function(e){for(var t=0;t<this.array.length;t++)e(this.array[t],t)}};function N(e,t,r){for(var n=0;n<e.length;n++){var i=e[n];if(ie(i,t,r))return i}}function ie(e,t,r){var n=e.filter;if(typeof n=="string"){if(n===t.nodeName.toLowerCase())return!0}else if(Array.isArray(n)){if(n.indexOf(t.nodeName.toLowerCase())>-1)return!0}else if(typeof n=="function"){if(n.call(e,t,r))return!0}else throw new TypeError("`filter` needs to be a string, array, or function")}function ae(e){var t=e.element,r=e.isBlock,n=e.isVoid,i=e.isPre||function(p){return p.nodeName==="PRE"};if(!(!t.firstChild||i(t))){for(var a=null,o=!1,l=null,c=q(l,t,i);c!==t;){if(c.nodeType===3||c.nodeType===4){var m=c.data.replace(/[ \r\n\t]+/g," ");if((!a||/ $/.test(a.data))&&!o&&m[0]===" "&&(m=m.substr(1)),!m){c=b(c);continue}c.data=m,a=c}else if(c.nodeType===1)r(c)||c.nodeName==="BR"?(a&&(a.data=a.data.replace(/ $/,"")),a=null,o=!1):n(c)||i(c)?(a=null,o=!0):a&&(o=!1);else{c=b(c);continue}var g=q(l,c,i);l=c,c=g}a&&(a.data=a.data.replace(/ $/,""),a.data||b(a))}}function b(e){var t=e.nextSibling||e.parentNode;return e.parentNode.removeChild(e),t}function q(e,t,r){return e&&e.parentNode===t||r(t)?t.nextSibling||t.parentNode:t.firstChild||t.nextSibling||t.parentNode}var D=typeof window<"u"?window:{};function oe(){var e=D.DOMParser,t=!1;try{new e().parseFromString("","text/html")&&(t=!0)}catch{}return t}function le(){var e=function(){};return ce()?e.prototype.parseFromString=function(t){var r=new window.ActiveXObject("htmlfile");return r.designMode="on",r.open(),r.write(t),r.close(),r}:e.prototype.parseFromString=function(t){var r=document.implementation.createHTMLDocument("");return r.open(),r.write(t),r.close(),r},e}function ce(){var e=!1;try{document.implementation.createHTMLDocument("").open()}catch{D.ActiveXObject&&(e=!0)}return e}var se=oe()?D.DOMParser:le();function ue(e,t){var r;if(typeof e=="string"){var n=fe().parseFromString('<x-turndown id="turndown-root">'+e+"</x-turndown>","text/html");r=n.getElementById("turndown-root")}else r=e.cloneNode(!0);return ae({element:r,isBlock:R,isVoid:W,isPre:t.preformattedCode?de:null}),r}var x;function fe(){return x=x||new se,x}function de(e){return e.nodeName==="PRE"||e.nodeName==="CODE"}function me(e,t){return e.isBlock=R(e),e.isCode=e.nodeName==="CODE"||e.parentNode.isCode,e.isBlank=he(e),e.flankingWhitespace=ge(e,t),e}function he(e){return!W(e)&&!re(e)&&/^\s*$/i.test(e.textContent)&&!te(e)&&!ne(e)}function ge(e,t){if(e.isBlock||t.preformattedCode&&e.isCode)return{leading:"",trailing:""};var r=pe(e.textContent);return r.leadingAscii&&B("left",e,t)&&(r.leading=r.leadingNonAscii),r.trailingAscii&&B("right",e,t)&&(r.trailing=r.trailingNonAscii),{leading:r.leading,trailing:r.trailing}}function pe(e){var t=e.match(/^(([ \t\r\n]*)(\s*))(?:(?=\S)[\s\S]*\S)?((\s*?)([ \t\r\n]*))$/);return{leading:t[1],leadingAscii:t[2],leadingNonAscii:t[3],trailing:t[4],trailingNonAscii:t[5],trailingAscii:t[6]}}function B(e,t,r){var n,i,a;return e==="left"?(n=t.previousSibling,i=/ $/):(n=t.nextSibling,i=/^ /),n&&(n.nodeType===3?a=i.test(n.nodeValue):r.preformattedCode&&n.nodeName==="CODE"?a=!1:n.nodeType===1&&!R(n)&&(a=i.test(n.textContent))),a}var ve=Array.prototype.reduce,ye=[[/\\/g,"\\\\"],[/\*/g,"\\*"],[/^-/g,"\\-"],[/^\+ /g,"\\+ "],[/^(=+)/g,"\\$1"],[/^(#{1,6}) /g,"\\$1 "],[/`/g,"\\`"],[/^~~~/g,"\\~~~"],[/\[/g,"\\["],[/\]/g,"\\]"],[/^>/g,"\\>"],[/_/g,"\\_"],[/^(\d+)\. /g,"$1\\. "]];function S(e){if(!(this instanceof S))return new S(e);var t={rules:u,headingStyle:"setext",hr:"* * *",bulletListMarker:"*",codeBlockStyle:"indented",fence:"```",emDelimiter:"_",strongDelimiter:"**",linkStyle:"inlined",linkReferenceStyle:"full",br:"  ",preformattedCode:!1,blankReplacement:function(r,n){return n.isBlock?`

`:""},keepReplacement:function(r,n){return n.isBlock?`

`+n.outerHTML+`

`:n.outerHTML},defaultReplacement:function(r,n){return n.isBlock?`

`+r+`

`:r}};this.options=J({},t,e),this.rules=new _(this.options)}S.prototype={turndown:function(e){if(!we(e))throw new TypeError(e+" is not a string, or an element/document/fragment node.");if(e==="")return"";var t=j.call(this,new ue(e,this.options));return Ee.call(this,t)},use:function(e){if(Array.isArray(e))for(var t=0;t<e.length;t++)this.use(e[t]);else if(typeof e=="function")e(this);else throw new TypeError("plugin must be a Function or an Array of Functions");return this},addRule:function(e,t){return this.rules.add(e,t),this},keep:function(e){return this.rules.keep(e),this},remove:function(e){return this.rules.remove(e),this},escape:function(e){return ye.reduce(function(t,r){return t.replace(r[0],r[1])},e)}};function j(e){var t=this;return ve.call(e.childNodes,function(r,n){n=new me(n,t.options);var i="";return n.nodeType===3?i=n.isCode?n.nodeValue:t.escape(n.nodeValue):n.nodeType===1&&(i=Ae.call(t,n)),X(r,i)},"")}function Ee(e){var t=this;return this.rules.forEach(function(r){typeof r.append=="function"&&(e=X(e,r.append(t.options)))}),e.replace(/^[\t\r\n]+/,"").replace(/[\t\r\n\s]+$/,"")}function Ae(e){var t=this.rules.forNode(e),r=j.call(this,e),n=e.flankingWhitespace;return(n.leading||n.trailing)&&(r=r.trim()),n.leading+t.replacement(r,e,this.options)+n.trailing}function X(e,t){var r=P(e),n=I(t),i=Math.max(e.length-r.length,t.length-n.length),a=`

`.substring(0,i);return r+a+n}function we(e){return e!=null&&(typeof e=="string"||e.nodeType&&(e.nodeType===1||e.nodeType===9||e.nodeType===11))}var G=S;var T=new G({headingStyle:"atx",hr:"---",bulletListMarker:"-",codeBlockStyle:"fenced",emDelimiter:"*",strongDelimiter:"**",linkStyle:"inlined"});T.addRule("tcoLinks",{filter:e=>e.nodeName==="A"&&!!e.getAttribute("href")?.includes("t.co"),replacement:(e,t)=>{let r=t,n=r.getAttribute("title"),i=r.textContent?.trim()||"",a=n&&n.startsWith("http")?n:i,o=n&&n.startsWith("http")?n:r.href;return a.startsWith("http")||a.includes(".")?`[${a}](${o})`:`[${i}](${o})`}});T.addRule("xImages",{filter:"img",replacement:(e,t)=>{let r=t,n=r.getAttribute("alt")||"Image",i=r.getAttribute("src")||"";return i.includes("pbs.twimg.com")&&!i.includes("format=")&&(i=i.replace(/&name=\w+/,"&name=large")),i?`![${n}](${i})`:""}});T.addRule("xVideos",{filter:"video",replacement:(e,t)=>{let r=t,n=r.getAttribute("poster")||"",a=r.querySelector("source")?.getAttribute("src")||""||n;return a?`[\u{1F3A5} Video](${a})`:"[\u{1F3A5} Video]"}});var h={articleTitle:'[data-testid="twitter-article-title"]',articleRichText:'[data-testid="twitterArticleRichTextView"]',articleDraftContent:'[data-testid="longformRichTextComponent"]',articleCodeBlock:'[data-testid="markdown-code-block"]',tweetText:'[data-testid="tweetText"]',userName:'[data-testid="User-Name"]',tweetPhoto:'[data-testid="tweetPhoto"]',engagementGroup:'[role="group"]',followButton:'[data-testid$="-follow"]',caret:'[data-testid="caret"]',readMore:'[data-testid="tweet-text-show-more-link"]'};function Se(){return!!(document.querySelector(h.articleTitle)||document.querySelector(h.articleRichText)||document.querySelector(h.articleDraftContent))}function K(){let e=document.querySelector(h.userName);if(!e)return{name:"Unknown",handle:"unknown"};let t=e.querySelectorAll("a"),r="Unknown",n="unknown";for(let i of t){let a=i.textContent?.trim()||"";a.startsWith("@")?n=a:a&&r==="Unknown"&&(r=a)}if(n==="unknown")for(let i of t){let o=(i.getAttribute("href")||"").match(/^\/([A-Za-z0-9_]+)$/);if(o){n=`@${o[1]}`;break}}return{name:r,handle:n}}function Y(){let e=document.querySelector('article[role="article"] time');if(e){let t=e.getAttribute("datetime");return t||e.textContent?.trim()||""}return new Date().toISOString()}function z(){return window.location.pathname.match(/\/status\/(\d+)/)?.[1]||"unknown"}function Te(e){let t=e.cloneNode(!0);return t.querySelectorAll('[role="group"]').forEach(r=>r.remove()),t.querySelectorAll('[data-testid$="-follow"]').forEach(r=>r.remove()),t.querySelectorAll('[data-testid="caret"]').forEach(r=>r.remove()),t.querySelectorAll('[data-testid="tweet-text-show-more-link"]').forEach(r=>r.remove()),t.querySelectorAll('[aria-label="Share post"]').forEach(r=>r.remove()),t.querySelectorAll('[aria-label="Bookmark"]').forEach(r=>r.remove()),t.querySelectorAll('[data-testid="bookmark"]').forEach(r=>r.remove()),t.querySelectorAll('a[href*="/subscribe"]').forEach(r=>{(r.closest('div[role="link"]')||r.parentElement)?.remove()}),t.querySelectorAll('button, nav, [role="navigation"]').forEach(r=>r.remove()),t.querySelectorAll('[aria-hidden="true"]').forEach(r=>{!r.querySelector("img")&&r.tagName!=="IMG"&&r.remove()}),t}function ke(){let e=K(),t=Y(),r=z(),n=window.location.href,i=document.querySelector(h.tweetText),a="";if(i){let m=Te(i);a=T.turndown(m.innerHTML).trim()}let o=document.querySelector('article[role="article"]'),l=[];o&&(o.querySelectorAll(`${h.tweetPhoto} img`).forEach(p=>{let f=p.src;f&&!f.includes("emoji")&&!f.includes("profile_images")&&(f.includes("pbs.twimg.com")&&(f=f.replace(/&name=\w+/,"&name=large")),l.push(`![Image](${f})`))}),o.querySelectorAll("video").forEach(p=>{let f=p.getAttribute("poster");f&&l.push(`[\u{1F3A5} Video](${f})`)}));let c=[`# ${e.name} (${e.handle})`,"",a];return l.length>0&&c.push("",...l),c.push("","---","",`> Source: ${n}`,`> Date: ${t}`),{type:"tweet",author:e,markdown:c.join(`
`),sourceUrl:n,date:t,tweetId:r}}function Ne(){let e=K(),t=Y(),r=z(),n=window.location.href,i,a=document.querySelector(h.articleTitle);a&&(i=a.textContent?.trim());let o=document.querySelector(h.articleRichText);if(!o)throw new Error("Could not find the article body. The page may not have fully loaded.");let l=[],c=o.querySelector(h.articleDraftContent)||o,g=(c.querySelector("[data-contents]")||c).children;for(let k=0;k<g.length;k++){let s=g[k],L=s.querySelector('[data-testid="markdown-code-block"]');if(L||s.getAttribute("data-testid")==="markdown-code-block"){let d=L||s,y=d.querySelector("code")?.className?.match(/language-(\w+)/)?.[1]||"",A=d.querySelector('[class*="r-1aiqnjv"]'),Q=y||A?.textContent?.trim()||"",M=d.querySelector("pre"),Z=(M?.querySelector("code")||M)?.textContent||"";l.push("",`\`\`\`${Q}`,Z.trimEnd(),"```","");continue}if(s.querySelector('[role="separator"]')){l.push("","---","");continue}if(s.querySelector(".longform-header-one")||(s.classList.contains("longform-header-one")?s:null)||s.querySelector("h1.longform-header-one")){let d=s.textContent?.trim()||"";d&&l.push("",`# ${d}`,"");continue}if(s.querySelector(".longform-header-two")||(s.classList.contains("longform-header-two")?s:null)||s.querySelector("h2.longform-header-two")){let d=s.textContent?.trim()||"";d&&l.push("",`## ${d}`,"");continue}if(s.tagName==="UL"){s.querySelectorAll(".longform-unordered-list-item").forEach(E=>{let y=v(E);y&&l.push(`- ${y}`)});continue}if(s.classList.contains("longform-unordered-list-item")){let d=v(s);d&&l.push(`- ${d}`);continue}if(s.tagName==="OL"){s.querySelectorAll("li").forEach((E,y)=>{let A=v(E);A&&l.push(`${y+1}. ${A}`)});continue}let O=v(s);O?l.push(O):s.textContent?.trim()===""&&l.push("")}let p=l.join(`
`).replace(/\n{3,}/g,`

`).trim(),f=[];return i?f.push(`# ${i}`,"",`*By ${e.name} (${e.handle})*`,""):f.push(`# Article by ${e.name} (${e.handle})`,""),f.push(p,"","---","",`> Source: ${n}`,`> Date: ${t}`),{type:"article",author:e,title:i,markdown:f.join(`
`),sourceUrl:n,date:t,tweetId:r}}function be(e){if(e.hasAttribute("data-offset-key")||e.className.includes("DraftStyleDefault")||e.className.includes("longform-"))return!1;let t=Array.from(e.children),r=t.length===1&&t[0].tagName==="A",n=t.some(a=>a.tagName==="A"||a.querySelector("a"));if(r)return!0;let i=0;for(let a of e.childNodes)a.nodeType===Node.TEXT_NODE&&(i+=(a.textContent||"").trim().length);return n&&i===0&&t.length<=2}function v(e){let t="";for(let r of e.childNodes){if(r.nodeType===Node.TEXT_NODE){t+=r.textContent||"";continue}if(r.nodeType!==Node.ELEMENT_NODE)continue;let n=r;if(n.tagName==="A"){let i=n.getAttribute("href")||"",a=n.textContent?.trim()||"",o=i.startsWith("//")?`https:${i}`:i.startsWith("/")?`https://x.com${i}`:i;t+=`[${a}](${o})`;continue}if(n.querySelector("a")&&be(n)){let i=n.querySelector("a"),a=i.getAttribute("href")||"",o=i.textContent?.trim()||"",l=a.startsWith("//")?`https:${a}`:a.startsWith("/")?`https://x.com${a}`:a;t+=`[${o}](${l})`;continue}if(n.style.fontWeight==="bold"||n.tagName==="STRONG"||n.tagName==="B"){let i=v(n);t+=`**${i}**`;continue}if(n.style.fontStyle==="italic"||n.tagName==="EM"||n.tagName==="I"){let i=v(n);t+=`*${i}*`;continue}t+=v(n)}return t}function xe(){try{return window.location.pathname.includes("/status/")?{success:!0,data:Se()?Ne():ke()}:{success:!1,error:"Not on an X.com status page. Navigate to a tweet or article first."}}catch(e){return{success:!1,error:e instanceof Error?e.message:String(e)}}}chrome.runtime.onMessage.addListener((e,t,r)=>{if(e.action==="EXTRACT"){let n=xe();r(n)}return!0});})();
