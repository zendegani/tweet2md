"use strict";(()=>{var a=document.getElementById("btn-download"),o=document.getElementById("status");function r(e,t){o.textContent=e,o.className=`status ${t}`,t==="success"&&setTimeout(()=>{o.className="status hidden"},3e3)}function n(e){a.disabled=e,a.classList.toggle("loading",e);let t=a.querySelector(".btn-label");t&&(t.textContent=e?"Extracting\u2026":"Download .md")}function d(e){if(!e)return"tweet.md";let t=e.author.handle.replace("@",""),s=e.tweetId;if(e.type==="article"&&e.title){let c=e.title.toLowerCase().replace(/[^a-z0-9]+/g,"-").replace(/^-|-$/g,"").slice(0,60);return`${t}-${c}.md`}return`${t}-${s}.md`}a.addEventListener("click",async()=>{n(!0),o.className="status hidden";try{let[e]=await chrome.tabs.query({active:!0,currentWindow:!0});if(!e?.id){r("Unable to access the current tab.","error"),n(!1);return}let t=e.url||"";if(!t.includes("x.com/")&&!t.includes("twitter.com/")){r("Navigate to a tweet or article on X.com first.","error"),n(!1);return}if(!t.includes("/status/")){r("Open a specific tweet or article page (with /status/ in the URL).","error"),n(!1);return}let s=await chrome.tabs.sendMessage(e.id,{action:"EXTRACT"});if(!s.success||!s.data){r(s.error||"Failed to extract content.","error"),n(!1);return}let c={action:"DOWNLOAD_MD",content:s.data.markdown,filename:d(s.data)};chrome.runtime.sendMessage(c,i=>{if(chrome.runtime.lastError||!i?.success)r(i?.error||"Download failed.","error");else{let l=s.data.type==="article"?"Article downloaded!":"Tweet downloaded!";r(`\u2713 ${l}`,"success")}n(!1)})}catch(e){let t=e instanceof Error?e.message:"An unexpected error occurred.";t.includes("Receiving end does not exist")?r("Reload the page and try again.","error"):r(t,"error"),n(!1)}});})();
